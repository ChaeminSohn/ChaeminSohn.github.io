---
layout: single
title: "[TIL] ì˜µì €ë²„ íŒ¨í„´(Observer Pattern)"
categories:
tag: [TIL, Unity, C#]
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
author_profile: false
excerpt: ""
---

---

# ğŸ“•í•™ìŠµ ê°œìš”

ì˜¤ëŠ˜ì€ ê²Œì„ ê°œë°œì—ì„œ ì¤‘ìš”í•œ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜ì¸ **ì˜µì €ë²„ íŒ¨í„´(Observer Pattern)**ì— ëŒ€í•´ ê¹Šì´ ìˆê²Œ í•™ìŠµí•˜ê³ , ì´ë¥¼ Unity í™˜ê²½ì—ì„œ í”Œë ˆì´ì–´ UI(íŠ¹íˆ ì²´ë ¥ ë°”) ì—…ë°ì´íŠ¸ì— ì ìš©í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì„ íƒêµ¬í–ˆë‹¤. ëª©í‘œëŠ” ì‹œìŠ¤í…œ ê°„ì˜ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  ìœ ì—°í•˜ë©° í™•ì¥ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì´ì—ˆë‹¤.

---

# ğŸ“–í•™ìŠµ ë‚´ìš©

## ì˜µì €ë²„ íŒ¨í„´ì´ë€?

ì˜µì €ë²„ íŒ¨í„´ì€ ê°ì²´ ì§€í–¥ ë””ìì¸ íŒ¨í„´ ì¤‘ í•˜ë‚˜ë¡œ, í•œ ê°ì²´(ì£¼ì²´, Subject)ì˜ ìƒíƒœê°€ ë³€ê²½ë˜ë©´ ê·¸ ê°ì²´ì— ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ ê°ì²´ë“¤(ì˜µì €ë²„, Observer)ì—ê²Œ ìë™ìœ¼ë¡œ ì•Œë¦¼(Notification)ì´ê°€ì„œ ì—…ë°ì´íŠ¸ë˜ë„ë¡ í•˜ëŠ” ì¼ëŒ€ë‹¤(one-to-many) ì˜ì¡´ì„±ì„ ì •ì˜í•˜ëŠ” íŒ¨í„´ì´ë‹¤..

ì£¼ì²´ëŠ” ìì‹ ì—ê²Œ ë“±ë¡ëœ ì—¬ëŸ¬ ì˜µì €ë²„ë“¤ì˜ ëª©ë¡ì„ ìœ ì§€í•˜ë©°, ìì‹ ì˜ ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì´ ì˜µì €ë²„ë“¤ì—ê²Œ ë³€ê²½ ì‚¬ì‹¤ì„ ì•Œë¦¬ê³ , ì˜µì €ë²„ë“¤ì€ ì´ ì•Œë¦¼ì„ ë°›ì•„ í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ì´ íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´ ì£¼ì²´ì™€ ì˜µì €ë²„ ê°„ì˜ **ëŠìŠ¨í•œ ê²°í•©**ì„ ìœ ì§€í•  ìˆ˜ ìˆì–´, ì„œë¡œì˜ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ì•Œ í•„ìš” ì—†ì´ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì–´ ì‹œìŠ¤í…œì˜ ìœ ì—°ì„±ê³¼ í™•ì¥ì„±ì„ ë†’ì—¬ì¤€ë‹¤.

## 1. ê¸°ë³¸ ì˜µì €ë²„ íŒ¨í„´: ì§ì ‘ ì°¸ì¡° ë°©ì‹

- ê°œë…: í•œ ê°ì²´ì˜ ìƒíƒœê°€ ë³€í•˜ë©´ ê·¸ ê°ì²´ì— ì˜ì¡´í•˜ëŠ” ë‹¤ë¥¸ ê°ì²´ë“¤(ì˜µì €ë²„)ì—ê²Œ ìë™ìœ¼ë¡œ ì•Œë¦¼ì´ ê°€ì„œ ì—…ë°ì´íŠ¸ë˜ëŠ” ë°©ì‹.

- êµ¬í˜„:
  1. `IHealthObserver` ì¸í„°í˜ì´ìŠ¤: ì˜µì €ë²„ê°€ êµ¬í˜„í•´ì•¼ í•  `UpdateHealth(current, max)` ë©”ì„œë“œ ì •ì˜.
  2. `PlayerHealth` (ì£¼ì²´): í”Œë ˆì´ì–´ì˜ ì²´ë ¥ ë°ì´í„°ë¥¼ ê°€ì§€ë©°, `List<IHealthObserver>`ë¥¼ í†µí•´ ì˜µì €ë²„ë“¤ì„ ê´€ë¦¬. `RegisterObserver`, `UnregisterObserver`, `NotifyObservers` ë©”ì„œë“œë¥¼ ê°€ì§. ì²´ë ¥ ë³€ê²½ ì‹œ `NotifyObservers` í˜¸ì¶œ.
  3. `PlayerHealthUI` (ì˜µì €ë²„): `IHealthObserver`ë¥¼ êµ¬í˜„. `PlayerHealth` ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ì§ì ‘ ë°›ì•„ `Start()`ì—ì„œ ìì‹ ì„ ì˜µì €ë²„ë¡œ ë“±ë¡í•˜ê³ , `OnDestroy()`ì—ì„œ í•´ì œ. `UpdateHealth` ë©”ì„œë“œì—ì„œ UI ìš”ì†Œ(í…ìŠ¤íŠ¸, ìŠ¬ë¼ì´ë”) ì—…ë°ì´íŠ¸.

<details>
<summary>ì˜ˆì‹œ ì½”ë“œ</summary>
<div markdown="1">

```c#
// ì˜µì €ë²„ ì¸í„°í˜ì´ìŠ¤
public interface IHealthObserver
{
    void UpdateHealth(int currentHealth, int maxHealth);
}

// ì£¼ì²´ (PlayerHealth)
public class PlayerHealth : MonoBehaviour
{
    private List<IHealthObserver> _observers = new List<IHealthObserver>();
    private int _currentHealth;
    private int _maxHealth = 100;

    public void RegisterObserver(IHealthObserver observer)
    {
        if (!_observers.Contains(observer))
            _observers.Add(observer);
    }

    public void UnregisterObserver(IHealthObserver observer)
    {
        if (_observers.Contains(observer))
            _observers.Remove(observer);
    }

    private void NotifyObservers()
    {
        foreach (var observer in _observers)
        {
            observer.UpdateHealth(_currentHealth, _maxHealth);
        }
    }

    public void TakeDamage(int damage)
    {
        _currentHealth -= damage;
        NotifyObservers();
    }
}

// ì˜µì €ë²„ (PlayerHealthUI)
public class PlayerHealthUI : MonoBehaviour, IHealthObserver
{
    public PlayerHealth playerHealthSubject; // ì¸ìŠ¤í™í„°ì—ì„œ í• ë‹¹
    public Text healthText;

    void Start()
    {
        playerHealthSubject?.RegisterObserver(this);
    }

    void OnDestroy()
    {
        playerHealthSubject?.UnregisterObserver(this);
    }

    public void UpdateHealth(int currentHealth, int maxHealth)
    {
        healthText.text = $"HP: {currentHealth} / {maxHealth}";
    }
}
```

</div>
</details>

- ì¥ì :

  - ê°œë…ì´ ë¹„êµì  ë‹¨ìˆœí•˜ê³  ì§ê´€ì ì´ë‹¤.
  - ì†Œê·œëª¨ ì‹œìŠ¤í…œì´ë‚˜ ê´€ê³„ê°€ ëª…í™•í•œ ê²½ìš° ë¹ ë¥´ê²Œ êµ¬í˜„ ê°€ëŠ¥í•˜ë‹¤.

- ë‹¨ì :
  - ì£¼ì²´ì™€ ì˜µì €ë²„ ê°„ì˜ **ê°•í•œ ê²°í•©**ì´ ë°œìƒí•œë‹¤. ì˜µì €ë²„ëŠ” ì£¼ì²´ì˜ êµ¬ì²´ì ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì•Œì•„ì•¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.
  - ì£¼ì²´ëŠ” ì˜µì €ë²„ì˜ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•˜ê³ , ì˜µì €ë²„ëŠ” ì£¼ì²´ì˜ ì¡´ì¬ë¥¼ ì•Œì•„ì•¼ í•œë‹¤.

## 2. ê°„ë‹¨í•œ ì •ì  ì´ë²¤íŠ¸ ë²„ìŠ¤(Event Bus)

- ê°œë…: ì£¼ì²´(ë°œí–‰ì, Publisher)ì™€ ì˜µì €ë²„(êµ¬ë…ì, Subscriber) ì‚¬ì´ì— ì¤‘ê°œì(ì´ë²¤íŠ¸ ë²„ìŠ¤)ë¥¼ ë‘ì–´ ì§ì ‘ì ì¸ ì°¸ì¡° ì—†ì´ í†µì‹ í•˜ê²Œ í•˜ëŠ” ë°©ì‹.

- êµ¬í˜„:

  1. `GameEvents` ì •ì  í´ë˜ìŠ¤ ìƒì„±.
  2. ë‚´ë¶€ì— `public static event Action<int, int> OnPlayerHealthChanged;` ì™€ ê°™ì´ `C# event`ì„ ì–¸.
  3. ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ëŠ” `public static void RaisePlayerHealthChanged(int current, int max)` ë©”ì„œë“œ êµ¬í˜„.
  4. `PlayerHealth` (ë°œí–‰ì): ì²´ë ¥ ë³€ê²½ ì‹œ `GameEvents.RaisePlayerHealthChanged(...) `í˜¸ì¶œ. ë” ì´ìƒ ì˜µì €ë²„ ë¦¬ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•ŠìŒ.
  5. `PlayerHealthUI` (êµ¬ë…ì): `OnEnable()`ì—ì„œ `GameEvents.OnPlayerHealthChanged += MyHealthUpdateHandler;`ë¡œ êµ¬ë…, `OnDisable()`ì—ì„œ êµ¬ë… í•´ì œ.

<details>
<summary>ì˜ˆì‹œ ì½”ë“œ</summary>
<div markdown="1">

```c#
  // ì´ë²¤íŠ¸ ë²„ìŠ¤ (GameEvents)
  public static class GameEvents
  {
    public static event Action<int, int> OnPlayerHealthChanged;

    public static void RaisePlayerHealthChanged(int currentHealth, int maxHealth)
    {
        OnPlayerHealthChanged?.Invoke(currentHealth, maxHealth);
    }
  }


// ë°œí–‰ì (PlayerHealth) - ì¼ë¶€
public class PlayerHealth : MonoBehaviour
{
private int _currentHealth;
private int _maxHealth = 100;

    public void TakeDamage(int damage)
    {
        _currentHealth -= damage;
        // ...
        GameEvents.RaisePlayerHealthChanged(_currentHealth, _maxHealth);
    }

}

// êµ¬ë…ì (PlayerHealthUI) - ì¼ë¶€
public class PlayerHealthUI : MonoBehaviour
{
public Text healthText;

    void OnEnable()
    {
        GameEvents.OnPlayerHealthChanged += HandleHealthChanged;
    }

    void OnDisable()
    {
        GameEvents.OnPlayerHealthChanged -= HandleHealthChanged;
    }

    private void HandleHealthChanged(int currentHealth, int maxHealth)
    {
        healthText.text = $"HP: {currentHealth} / {maxHealth}";
    }

}
```

</div>
</details>

- ì¥ì :

  - ë°œí–‰ìì™€ êµ¬ë…ì ê°„ì˜ ê²°í•©ë„ê°€ í¬ê²Œ ë‚®ì•„ì§.
  - ìƒˆë¡œìš´ êµ¬ë…ìë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ê¸°ì¡´ êµ¬ë…ìë¥¼ ì œê±°í•  ë•Œ ë°œí–‰ì ì½”ë“œë¥¼ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ìŒ.

- ë‹¨ì :

  - ì •ì  í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œ ê¸€ë¡œë²Œ ì´ë²¤íŠ¸ ë²„ìŠ¤ëŠ” ë‚¨ìš©ë  ê²½ìš° ì´ë²¤íŠ¸ íë¦„ ì¶”ì ì´ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŒ.

## 3. ì´ë²¤íŠ¸ íƒ€ì… ëª…ì‹œ ì‹œë„: ì—´ê±°í˜•(Enum) + ì¼ë°˜í™”ëœ GameEventArgsBase

- ë™ê¸°: ì´ë²¤íŠ¸ì˜ ì¢…ë¥˜ë¥¼ ë” ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ì—ˆë‹¤.

<details>
<summary>êµ¬í˜„ ì½”ë“œ</summary>
<div markdown="1">

```c#
public enum GameEventType { PlayerHealthChanged, PlayerDied }

public abstract class GameEventArgsBase
{
    public GameEventType Type { get; protected set; }
}

public class PlayerHealthChangedEventArgs : GameEventArgsBase
{
    public int CurrentHealth { get; }
    public int MaxHealth { get; }
    public PlayerHealthChangedEventArgs(int current, int max)
    {
        Type = GameEventType.PlayerHealthChanged;
        CurrentHealth = current; MaxHealth = max;
    }
}
// ì´ë²¤íŠ¸ ë²„ìŠ¤ëŠ” Action<GameEventArgsBase> OnGameEvent; ë¥¼ ê°€ì§

// êµ¬ë…ì (PlayerHealthUI) - í•¸ë“¤ëŸ¬ ë¶€ë¶„
private void HandleGameEvent(GameEventArgsBase eventArgs)
{
    if (eventArgs.Type == GameEventType.PlayerHealthChanged)
    {
        if (eventArgs is PlayerHealthChangedEventArgs healthArgs)
        {
            // healthArgs.CurrentHealth, healthArgs.MaxHealth ì‚¬ìš©
            healthText.text = $"HP: {healthArgs.CurrentHealth} / {healthArgs.MaxHealth}";
        }
    }
    // else if (eventArgs.Type == GameEventType.PlayerDied) { ... }
}
```

</div>
</details>

- ê¹¨ë‹¬ìŒ/ê³ ë¯¼:
  - êµ¬ë…ì ì¸¡ì—ì„œ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹  í›„, `if/switch`ë¬¸ìœ¼ë¡œ í•„í„°ë§ í•´ì•¼í•¨. ë¹„íš¨ìœ¨ì ìœ¼ë¡œ ëŠê»´ì§

## 4. íƒ€ì… ì•ˆì „ ì œë„¤ë¦­ ì´ë²¤íŠ¸ ë²„ìŠ¤ (ë‚´ê°€ ì„ íƒí•œ ë°©ì‹)

- ë™ê¸°: ì´ì „ ë°©ì‹ì˜ "êµ¬ë…ì í•„í„°ë§ ë¹„íš¨ìœ¨" ê°œì„ .

- ê°œë…: ì´ë²¤íŠ¸ ë°ì´í„° ê°ì²´ì˜ C# í´ë˜ìŠ¤ íƒ€ì… ìì²´ë¥¼ ì´ë²¤íŠ¸ì˜ ê³ ìœ  ì‹ë³„ìë¡œ ì‚¬ìš©.

<details>
<summary>êµ¬í˜„ ì½”ë“œ</summary>
<div markdown="1">

```c#
public static class EventBus
{
    // ì´ë²¤íŠ¸ íƒ€ì…ì„ í‚¤ë¡œ, í•´ë‹¹ ì´ë²¤íŠ¸ íƒ€ì…ì˜ í•¸ë“¤ëŸ¬(delegate)ë¥¼ ê°’ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ë”•ì…”ë„ˆë¦¬
    private static readonly Dictionary<Type, Delegate> eventDict
        = new Dictionary<Type, Delegate>();

    //íŠ¹ì • íƒ€ì…ì˜ ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•˜ëŠ” ë©”ì„œë“œ
    public static void Subscribe<TEvent>(Action<TEvent> handler)
    {
        Type eventType = typeof(TEvent);
        if(eventDict.TryGetValue(eventType, out Delegate existingHandler))
        {
            //ì´ë¯¸ í•´ë‹¹ íƒ€ì…ì˜ í•¸ë“¤ëŸ¬ê°€ ì¡´ì¬í•˜ë©´, ë¸ë¦¬ê²Œì´íŠ¸ì— ì¶”ê°€
            eventDict[eventType] = Delegate.Combine(existingHandler, handler);
        }
        else
        {
            //ìƒˆë¡œìš´ íƒ€ì…ì˜ í•¸ë“¤ëŸ¬ë¼ë©´, ë”•ì…”ë„ˆë¦¬ì— ìƒˆë¡œ ì¶”ê°€
            eventDict[eventType] = handler;
        }
    }

    //íŠ¹ì • íƒ€ì…ì˜ ì´ë²¤íŠ¸ êµ¬ë…ì„ í•´ì œí•˜ëŠ” ë©”ì„œë“œ
    public static void UnSubscribe<TEvent>(Action<TEvent> handler)
    {
        Type eventType = typeof(TEvent);

        if(eventDict.TryGetValue(eventType, out Delegate existingHandler))
        {
            Delegate newHandler = Delegate.Remove(existingHandler, handler);
            if(newHandler == null)
            {   //í•´ë‹¹ íƒ€ì…ì˜ í•¸ë“¤ëŸ¬ê°€ ëª¨ë‘ ì œê±°ë˜ì—ˆì„ ê²½ìš°
                eventDict.Remove(eventType);
            }
            else
            {
                eventDict[eventType] = newHandler;
                // Debug.Log($"[EventBus] Unsubscribed from {eventType.Name}");
            }
        }
    }


    //íŠ¹ì • íƒ€ì…ì˜ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ëŠ” ë©”ì„œë“œ
    public static void Raise<TEvent>(TEvent eventArgs)
    {
        Type eventType = typeof(TEvent);
        if(eventDict.TryGetValue(eventType, out Delegate existingHandler))
        {   //ì €ì¥ëœ ë¸ë¦¬ê²Œì´íŠ¸ë¥¼ ì›ë˜ì˜ Action<TEvent> íƒ€ì…ìœ¼ë¡œ ìºìŠ¤íŒ…í•˜ì—¬ í˜¸ì¶œ
            (existingHandler as Action<TEvent>)?.Invoke(eventArgs);
        }
        else
        {
            Debug.LogWarning($"[EventBus] No subscribers for event {eventType.Name}");
        }
    }
}
```

</div>
</details>

- ì¥ì : íƒ€ì… ì•ˆì „ì„±, êµ¬ë…ì íš¨ìœ¨ì„± (í•„ìš”í•œ ì´ë²¤íŠ¸ë§Œ ìˆ˜ì‹ ), ê¹”ë”í•œ í•¸ë“¤ëŸ¬.

- í•µì‹¬ ê¹¨ë‹¬ìŒ: ë³„ë„ì˜ GameEventType ì—´ê±°í˜•ì´ ë²„ìŠ¤ ë©”ì»¤ë‹ˆì¦˜ì— ë¶ˆí•„ìš”. C# íƒ€ì… ìì²´ê°€ ì‹ë³„ì.

# ğŸì˜¤ëŠ˜ ë°°ìš´ í•µì‹¬ ë‚´ìš© ì •ë¦¬

- ì˜µì €ë²„ íŒ¨í„´ì€ ì‹œìŠ¤í…œ ê°„ì˜ ì˜ì¡´ì„±ì„ ì¤„ì´ê³  ìœ ì—°ì„±ì„ í™•ë³´í•˜ëŠ” ë° í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.
- ë‹¨ìˆœí•œ ì§ì ‘ ì°¸ì¡° ë°©ì‹ì—ì„œ ì‹œì‘í•˜ì—¬, ì •ì  ì´ë²¤íŠ¸ ë²„ìŠ¤, ê·¸ë¦¬ê³  íƒ€ì… ì•ˆì „ ì œë„¤ë¦­ ì´ë²¤íŠ¸ ë²„ìŠ¤ë¡œ ë°œì „ì‹œì¼œ ë‚˜ê°€ë©´ì„œ ê° ë°©ì‹ì˜ ì¥ë‹¨ì ì„ ëª…í™•íˆ ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤.
- íŠ¹íˆ íƒ€ì… ì•ˆì „ ì œë„¤ë¦­ ì´ë²¤íŠ¸ ë²„ìŠ¤ëŠ” ì½”ë“œì˜ ê¹”ë”í•¨, íƒ€ì… ì•ˆì „ì„±, êµ¬ë…ì ì¸¡ì˜ íš¨ìœ¨ì„± ë©´ì—ì„œ ë§¤ìš° ë§Œì¡±ìŠ¤ëŸ¬ìš´ ì†”ë£¨ì…˜ì´ì—ˆë‹¤. "C# íƒ€ì… ìì²´ê°€ ì´ë²¤íŠ¸ ì‹ë³„ì"ë¼ëŠ” ê°œë…ì´ ì¸ìƒ ê¹Šì—ˆë‹¤.
- í´ë˜ìŠ¤ ì„¤ê³„(ì˜ˆ: PlayerStat)ì— ìˆì–´ì„œë„ ìº¡ìŠí™”, ë‹¨ì¼ ì±…ì„ ì›ì¹™ ë“±ì˜ OOP ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í• ì§€, ê·¸ë¦¬ê³  ë‹¤ì–‘í•œ ë°ì´í„° ê´€ë¦¬ ë°©ì‹(ê°œë³„ í•„ë“œ vs Dictionary)ì˜ ì¥ë‹¨ì ì„ ë¹„êµí•˜ë©° ê³ ë¯¼í•˜ëŠ” ê³¼ì • ìì²´ê°€ ì¢‹ì€ ê³µë¶€ê°€ ë˜ì—ˆë‹¤.
